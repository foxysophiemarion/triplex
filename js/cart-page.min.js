import"./app.min.js";(function(){const g="cart",q="cart_selected",r=document.querySelector("[data-fls-cart]");if(!r)return;const l=r.querySelector(".cart-items"),b=r.querySelector(".cart-total"),h=r.querySelector(".promo input"),v=r.querySelector(".promo__apply"),S=document.querySelector("[data-fls-addtocart]"),x=document.querySelector(".checkout");x&&x.addEventListener("click",()=>{const t=s(),a=o(),e=t.filter((c,n)=>a[n]);if(!e.length){alert("\u0412\u044B \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043B\u0438 \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430 \u0434\u043B\u044F \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u044F.");return}localStorage.setItem("checkout_items",JSON.stringify(e)),f&&localStorage.setItem("checkout_promo",f),window.location.href="/pay-page.html"});let f=null;function s(){try{return JSON.parse(localStorage.getItem(g))||[]}catch{return[]}}function u(t){localStorage.setItem(g,JSON.stringify(t))}function o(){try{return JSON.parse(localStorage.getItem(q))||[]}catch{return[]}}function d(t){localStorage.setItem(q,JSON.stringify(t))}function k(){const t=s().reduce((a,e)=>a+e.qty,0);S&&(S.textContent=t)}function p(t){return(t||0).toLocaleString("ru-RU")+" \u20BD"}function i(){const t=s(),a=o();if(l.innerHTML='<button class="cart-item__remove-all --icon-trash" aria-label="remove">\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0442\u043E\u0432\u0430\u0440\u044B</button>',!t.length){l.innerHTML='<p class="cart-message">\u0412\u0430\u0448\u0430 \u043A\u043E\u0440\u0437\u0438\u043D\u0430 \u043F\u0443\u0441\u0442\u0430</p>',b.textContent=p(0),k();return}t.forEach((e,c)=>{const n=a[c]!==!1,m=document.createElement("div");m.className="cart-item",m.innerHTML=`
                <div class="cart-item__absolute">
                    <label data-fls-checkbox class="cart-item__checkbox checkbox">
                        <input class="checkbox__input" type="checkbox" name="form-cart[check]" data-index="${c}" ${n?"checked":""}>
                        <span class="checkbox__text --icon-check"></span>
                    </label>
                </div>
                <div class="cart-item__image">
                    <img class="cart-item__img" src="${e.img}" alt="${e.title}">
                    <span class="cart-item__title">${e.title}</span>
                </div>
                <div data-fls-quantity class="quantity">
                    <button data-fls-quantity-minus type="button" class="quantity__button quantity__button--minus" data-index="${c}" aria-label="minus"></button>
                    <div class="quantity__input">
                        <input data-fls-quantity-value autocomplete="off" type="text" name="form-cart[quantity]" value="${e.qty}">
                    </div>
                    <button data-fls-quantity-plus type="button" class="quantity__button quantity__button--plus" data-index="${c}" aria-label="plus"></button>
                </div>
                <div class="cart-item__sum">${p(e.qty*e.price)}</div>
                <button class="cart-item__remove --icon-trash" data-index="${c}" aria-label="remove"></button>
            `,l.appendChild(m)}),_(),k()}function L(){return o().map((a,e)=>a?e:null).filter(a=>a!==null)}function _(){const t=s();let e=L().reduce((c,n)=>c+t[n].qty*t[n].price,0);f==="SALE10"&&(e=Math.round(e*.9)),b.textContent=p(e)}l.addEventListener("click",t=>{const a=s();let e=o();if(t.target.classList.contains("quantity__button--plus")){const c=+t.target.dataset.index;a[c].qty++,u(a),i()}if(t.target.classList.contains("quantity__button--minus")){const c=+t.target.dataset.index;a[c].qty>1?a[c].qty--:(a.splice(c,1),e.splice(c,1)),u(a),d(e),i()}if(t.target.classList.contains("cart-item__remove")){const c=+t.target.dataset.index;a.splice(c,1),e.splice(c,1),u(a),d(e),i()}if(t.target.classList.contains("cart-item__remove-all")){const c=a.filter((m,y)=>!e[y]),n=e.filter((m,y)=>!e[y]);u(c),d(n),i()}}),l.addEventListener("change",t=>{if(t.target.classList.contains("checkbox__input")){const a=+t.target.dataset.index,e=o();e[a]=t.target.checked,d(e),_()}if(t.target.matches("[data-fls-quantity-value]")){const a=+t.target.closest(".quantity").querySelector("[data-fls-quantity-plus]").dataset.index,e=s();let c=parseInt(t.target.value,10);(isNaN(c)||c<1)&&(c=1),e[a].qty=c,u(e),i()}}),v&&v.addEventListener("click",()=>{f=(h?.value||"").trim().toUpperCase()==="SALE10"?"SALE10":null,_()}),document.addEventListener("DOMContentLoaded",()=>{const t=s();let a=o();a.length<t.length&&(a=t.map((e,c)=>a[c]!==!1),d(a)),i()})})();
