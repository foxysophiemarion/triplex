import"./app.min.js";(function(){const b="cart",h="cart_selected",l=document.querySelector("[data-fls-cart]");if(!l)return;const o=l.querySelector(".cart-items"),v=l.querySelector(".cart-total"),S=l.querySelector(".promo input"),x=l.querySelector(".promo__apply"),k=document.querySelector("[data-fls-addtocart]"),L=document.querySelector(".checkout");L&&L.addEventListener("click",()=>{const t=n(),c=i(),e=t.filter((a,s)=>c[s]);if(!e.length){alert("\u0412\u044B \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043B\u0438 \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u0442\u043E\u0432\u0430\u0440\u0430 \u0434\u043B\u044F \u043E\u0444\u043E\u0440\u043C\u043B\u0435\u043D\u0438\u044F.");return}localStorage.setItem("checkout_items",JSON.stringify(e)),m&&localStorage.setItem("checkout_promo",m),window.location.href="/pay-page.html"});let m=null;function n(){try{return JSON.parse(localStorage.getItem(b))||[]}catch{return[]}}function r(t){localStorage.setItem(b,JSON.stringify(t))}function i(){try{return JSON.parse(localStorage.getItem(h))||[]}catch{return[]}}function u(t){localStorage.setItem(h,JSON.stringify(t))}function y(){const t=n().reduce((c,e)=>c+e.qty,0);k&&(k.textContent=t)}function f(t){return(t||0).toLocaleString("ru-RU")+" \u20BD"}function g(t){const e=n()[t],a=o.querySelector(`.cart-item [data-index="${t}"]`).closest(".cart-item");a&&(a.querySelector("[data-fls-quantity-value]").value=e.qty,a.querySelector(".cart-item__sum").textContent=f(e.qty*e.price)),_(),y()}function p(){const t=n(),c=i();if(o.innerHTML='<button class="cart-item__remove-all --icon-trash" aria-label="remove">\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0432\u0441\u0435 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u044B\u0435 \u0442\u043E\u0432\u0430\u0440\u044B</button>',!t.length){o.innerHTML='<p class="cart-message">\u0412\u0430\u0448\u0430 \u043A\u043E\u0440\u0437\u0438\u043D\u0430 \u043F\u0443\u0441\u0442\u0430</p>',v.textContent=f(0),y();return}t.forEach((e,a)=>{const s=c[a]!==!1,d=document.createElement("div");d.className="cart-item",d.innerHTML=`
                <div class="cart-item__absolute">
                    <label data-fls-checkbox class="cart-item__checkbox checkbox">
                        <input class="checkbox__input" type="checkbox" name="form-cart[check]" data-index="${a}" ${s?"checked":""}>
                        <span class="checkbox__text --icon-check"></span>
                    </label>
                </div>
                <div class="cart-item__image">
                    <img class="cart-item__img" src="${e.img}" alt="${e.title}">
                    <span class="cart-item__title">${e.title}</span>
                </div>
                <div data-fls-quantity class="quantity">
                    <button data-fls-quantity-minus type="button" class="quantity__button quantity__button--minus" data-index="${a}" aria-label="minus"></button>
                    <div class="quantity__input">
                        <input data-fls-quantity-value autocomplete="off" type="text" name="form-cart[quantity]" value="${e.qty}">
                    </div>
                    <button data-fls-quantity-plus type="button" class="quantity__button quantity__button--plus" data-index="${a}" aria-label="plus"></button>
                </div>
                <div class="cart-item__sum">${f(e.qty*e.price)}</div>
                <button class="cart-item__remove --icon-trash" data-index="${a}" aria-label="remove"></button>
            `,o.appendChild(d)}),_(),y()}function C(){return i().map((c,e)=>c?e:null).filter(c=>c!==null)}function _(){const t=n();let e=C().reduce((a,s)=>a+t[s].qty*t[s].price,0);m==="SALE10"&&(e=Math.round(e*.9)),v.textContent=f(e)}o.addEventListener("click",t=>{const c=n();let e=i();if(t.target.classList.contains("quantity__button--plus")){const a=+t.target.dataset.index;c[a].qty++,r(c),g(a)}if(t.target.classList.contains("quantity__button--minus")){const a=+t.target.dataset.index;c[a].qty>1?(c[a].qty--,r(c),g(a)):(c.splice(a,1),e.splice(a,1),r(c),u(e),p())}if(t.target.classList.contains("cart-item__remove")){const a=+t.target.dataset.index;c.splice(a,1),e.splice(a,1),r(c),u(e),p()}if(t.target.classList.contains("cart-item__remove-all")){const a=c.filter((d,q)=>!e[q]),s=e.filter((d,q)=>!e[q]);r(a),u(s),p()}}),o.addEventListener("change",t=>{if(t.target.classList.contains("checkbox__input")){const c=+t.target.dataset.index,e=i();e[c]=t.target.checked,u(e),_()}if(t.target.matches("[data-fls-quantity-value]")){const c=+t.target.closest(".quantity").querySelector("[data-fls-quantity-plus]").dataset.index,e=n();let a=parseInt(t.target.value,10);(isNaN(a)||a<1)&&(a=1),e[c].qty=a,r(e),g(c)}}),x&&x.addEventListener("click",()=>{m=(S?.value||"").trim().toUpperCase()==="SALE10"?"SALE10":null,_()}),document.addEventListener("DOMContentLoaded",()=>{const t=n();let c=i();c.length<t.length&&(c=t.map((e,a)=>c[a]!==!1),u(c)),p()})})();
